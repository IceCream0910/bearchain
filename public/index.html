<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>곰곰해온라인 :: BearChain</title>
    <script src="/public/module.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <link rel="stylesheet" type="text/css" href="/public/style.css">
    <script src="/socket.io/socket.io.js"></script>

    <script>
        var win = '<%if(locals.win){%><%=win%><%}else{0}%>';
        var lose = '<%if(locals.lose){%><%=lose%><%}else{0}%>';

        var load_text = '접속중입니다';
        var person = new Array(6);
        var socketId = "";

        function win_lose_pop() {
            if (win.length > 1) {
                document.getElementById("hide_win").style.display = "inline-block";
            }

            if (lose.length > 1) {
                document.getElementById("hide_lose").style.display = "inline-block";
            }
        }

        $(function() {
            
            var socket = io();
            
            socket.emit('main_join');
            
            //userlist: onUser
            socket.on('live_sv', function(userlist) {
                for(var i=1; i<=5; i++){
                    if(userlist[i]){
                        person[i] = userlist[i].length;
                    }
                    $('#p'+i).html(person[i]);
                    $('#d'+i).css("color", "white");
                    if(person[i] >= 5){
                        $('#d'+i).css("color", "red");
                    }
                }
            });


            //채널 선택(클릭)시 닉네임 포커스
            $('.room').click(function() {
                $('#nick').focus();
            });

        })

    </script>

</head>

<body onload="document.setUser.nickname.focus(); win_lose_pop(); ">
    <div class="screen">
        <div class="mainview">
            <div class="logo">
                곰곰해온라인
            </div>
            <div class="logo_semi">
                접속하기
            </div>
            <form name="setUser" method="post" action="/process/game">
                
                <div class="chDiv">
                <div class="load_list">
                   <label>
                       <input type="radio" name="ch" value="1"
                       <%if(locals.ch1){%><%=ch1%><%}%>>
                        <div class="room" id="d1">
                            <p class="r_name">채널 1</p>
                            <span class="r_num" id="p1">0</span>
                            <span class="r_num">/ 5</span>
                        </div>
                    </label>

                    <label>
                       <input type="radio" name="ch" value="2"
                       <%if(locals.ch2){%><%=ch2%><%}%>>
                        <div class="room" id="d2">
                            <p class="r_name">채널 2</p>
                            <span class="r_num" id="p2">0</span>
                            <span class="r_num">/ 5</span>
                        </div>
                    </label>


                    <label>
                       <input type="radio" name="ch" value="3"
                       <%if(locals.ch3){%><%=ch3%><%}%>>
                        <div class="room" id="d3">
                            <p class="r_name">채널 3</p>
                            <span class="r_num" id="p3">0</span>
                            <span class="r_num">/ 5</span>
                        </div>
                    </label>

                    <label>
                       <input type="radio" name="ch" value="4"
                       <%if(locals.ch4){%><%=ch4%><%}%>>
                        <div class="room" id="d4">
                            <p class="r_name">채널 4</p>
                            <span class="r_num" id="p4">0</span>
                            <span class="r_num">/ 5</span>
                        </div>
                    </label>


                    <label>
                       <input type="radio" name="ch" value="5"
                       <%if(locals.ch5){%><%=ch5%><%}%>>
                        <div class="room" id="d5">
                            <p class="r_name">자유채널</p>
                            <span class="r_num" id="p5">0</span>
                            <span class="r_num">/ 5</span>
                        </div>
                    </label>
                </div>
                <div class="loginDiv">
                    <input id="nick" type="text" name="nickname" maxlength="6" autocomplete="off" value="<%if(locals.uid){%><%=uid%><%}%>"><input type="submit" name="login" value="플레이">
                </div>
                
                <div class="text_info" style="float: left;">
                <p>채널과 닉네임(6자 이하)을 정하고 게임에 참가하세요!</p>
                <p style="color: yellow; margin-bottom: -10px;">
                    <%if(locals.msg){%>
                    <%=msg%>
                    <%}%>
                </p>
                </div>
                
                <div id="load_msg" style="display: none">
                    <span id="load_info">접속중입니다</span>
                    <p class="text_info">바로 게임이 시작되니 준비하세요!</p>
                </div>
            </div>
                    
            </form>
            
            
        </div>
        
        <div class="hide_win" id="hide_win">
            <div class="finish_box">
                <div class="win_text">WINNER!</div>
                <span class="text_info" style="color: dodgerblue; cursor:pointer; font-size: 25px;" onclick="location.href = '/'">다시 게임에 참가하기</span>
                <span class="text_info" style="margin: 0 20px;"></span><span class="text_info" style="color: crimson; cursor:pointer; font-size: 25px;" onclick="location.href = '/process/logout'">그만하기</span>
            </div>
        </div>

        <div class="hide_win" id="hide_lose" style="border-color: crimson">
            <div class="finish_box">
                <div class="win_text" style="color: crimson;">LOSE!</div>
                <span class="text_info" style="color: dodgerblue; cursor:pointer; font-size: 25px;" onclick="location.href = '/'">다시 게임에 참가하기</span>
                <span class="text_info" style="margin: 0 20px;"></span><span class="text_info" style="color: crimson; cursor:pointer; font-size: 25px;" onclick="location.href = '/process/logout'">그만하기</span>
            </div>
        </div>
        
    </div>
    
</body>

</html>
