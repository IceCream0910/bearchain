<!doctype html>
<html>

<head>
    <title>곰곰해 :: BearChain</title>
    <script src="/public/module.js" type="text/javascript"></script>
    <script src="/public/chat.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/public/style.css">
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        var data = {};
        //USER's DATA
        data.roomId = '<%= roomId %>';
        data.userId = '<%= userId %>';

        $(function() {
            $('#m').focus();

            //socket io
            var socket = io();

            socket.emit('join', data);

            $('#ansForm').submit(function() {
                if ($('#m').val() != "") {
                    var chatData = $('#m').val();
                    socket.emit('say', chatData, data.userId);
                    $('#m').val('');
                }
                return false;
            });
            
            socket.on('my_message', function(msg) {
                //해당 유저체인에 메시지(3글자) 삽입
                var msgTarget = "#answer_" + data.userId;
                $(msgTarget).append(msg);
            });

            socket.on('message', function(msg, user) {
                //해당 유저체인에 메시지(3글자) 삽입
                var msgTarget = "#answer_" + user;
                $(msgTarget).append(msg);
            });

            socket.on('login', function(nickname) {
                //유저체인 삽입 (새 유저)
                $('#chain').append('<div class="userchain"> <div class="answer" id="answer_' + nickname + '"> </div> <div class="usernick">' + nickname + '</div></div>')
            });

            socket.on('logout', function(received) {

            })
        })

    </script>
</head>

<body style="color: black;">
    <div class="screen">
        <div class="gameview">
            <div id="chain">
                <!--한명 체인 시작-->
                <div class="userchain">
                    <div class="answer" id="answer">
                        <!--채팅은 여기에 넣음-->무지개
                    </div>
                    <div class="usernick">
                        <!--닉네임은 여기에 넣음-->
                        곰돌이샘플
                    </div>
                </div>
                <!--한명 체인 끝-->
            </div>
        </div>
        <br />
        <div class="mychat">
            <div class="text_info">
                <p>정답을 입력하세요!</p>
            </div>
            <form id="ansForm" action="">
                <input id="m" type="text" name="myanswer" maxlength="3" autocomplete="off">
            </form>
        </div>
    </div>

</body>

</html>
